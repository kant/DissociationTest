---
title: "volcanos"
author: "Rayna M Harris"
date: "12/16/2017"
output: md_document
---

These are the packages I need for my volcano plots.

```{r setup, include=FALSE}
library(ggplot2)
library(cowplot)
library(dplyr)
library(ggrepel)
library(tidyverse)
#install.packages("ggrepel")
# set output file for figures 
knitr::opts_chunk$set(fig.path = '../figures/02_volcanoplots/')
```

Here I load the relevant dataframes and set the color palette.

```{r loaddata}
# dissocation DEGes
dissociation <- read.csv("../results/volcanoTreatment.csv", header = T, row.names = 1)

#set levels
dissociation$direction <- factor(dissociation$direction,
                             levels = c("HOMO", "DISS", "none"))

#set colors
dissociationcolor <-  c("HOMO" = "dodgerblue2", "DISS" = "firebrick1", "none" = "#d9d9d9")

# subfield specific degs
subfield <- read.csv("../results/volcanoCA1DG.csv", header = T, row.names = 1)
head(subfield)
```

Treatement volcano

```{r plot}
volcanoplot <- ggplot(dissociation, aes(x = lfc, y = pvalue)) + 
  geom_point(aes(color = factor(direction), shape = factor(direction)), 
             size = 1, alpha = 0.8, na.rm = T) + 
  theme_cowplot(font_size = 12, line_size = 0.25) +
    theme( legend.title = element_blank(),
        legend.position=c(.7,.75),
        panel.grid.minor=element_blank(),
        panel.grid.major=element_blank()) +
  scale_color_manual(values = dissociationcolor) +
  scale_x_continuous(name="log fold change",
                      limits = c(-10, 10)) +
  scale_y_continuous(name="-log10 p-value",
                     limits = c(-1, 18),
                     breaks = c(1,6,12,18)) +
  geom_hline(yintercept = 1,  size = 0.25, linetype = 2 ) + 
  scale_shape_manual(values = c(1,16,16))
volcanoplot  

  
pdf(file = "../figures/02_volcanoplots/Treatment_volcano.pdf", width=2.5, height=2.25)
plot(volcanoplot)
dev.off()
```

Caption: Differntial gene expression according to treatment is asymetric, with more genes enrighted in DISS. only 3 canddiate learning and memory genes identified.


Plotting CA1 vs. DG volcano plots. The color here is set inside. 

```{r subfield}
volcanoplot2 <- ggplot(subfield, aes(x = lfc, y = pvalue)) + 
  geom_point(aes(color = factor(direction), shape = factor(direction)), 
             size = 1, alpha = 0.8, na.rm = T) + 
  theme_cowplot(font_size = 12, line_size = 0.25) +
  theme(legend.title=element_blank(),
        legend.position=c(.75,.75),
        panel.grid.minor=element_blank(),
        panel.grid.major=element_blank()) + 
  scale_color_manual(values = c("CA1" = "#7570b3",
                                "DG" = "#d95f02", 
                                "none" = "#d9d9d9")) +   
  scale_x_continuous(name="log fold change",
                     limits = c(-10, 10)) +
  scale_y_continuous(name="-log10 p-value",
                     limits = c(0, 18),
                     breaks = c(1,6,12,18)) +
  geom_hline(yintercept = 1,  size = 0.25, linetype = 2 ) + 
  scale_shape_manual(values = c(16,16,16)) +
  
      annotate("text", label = "222", x = -9.5, y = 2, size = 3, color = "black") + 
    annotate("text", label = "262", x = 10, y = 2, size = 3, color = "black")
volcanoplot2 

pdf(file = "../figures/02_volcanoplots/CA1DG_volcano.pdf", width=2.5, height=2.25)
plot(volcanoplot2)
dev.off()

```

```{r figure2}

figure2 <- plot_grid(volcanoplot, volcanoplot2,  
                     nrow = 1, labels = c('A', 'B'), 
                     #align = 'h',
                     rel_widths = c(1,1))

figure2

pdf("../figures/figure2.pdf", width=5.5, height=3)
print(figure2)
dev.off()

ggsave(
  "../figures/figure2.png",
  figure2,
  width = 6,
  height = 3,
  dpi = 1200
)
```


## Useful R tutorials
- [ggplot axis help](http://ggplot2.tidyverse.org/reference/scale_continuous.html)
- [grepply help](http://www.gettinggeneticsdone.com/2016/01/repel-overlapping-text-labels-in-ggplot2.html)