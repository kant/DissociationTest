---
title: "05_combo.Rmd"
author: "Rayna M Harris"
date: March 13, 2017
output:
  md_document:
  variant: markdown_github
---
## Comparing Rayna's data and the Cembrowski data
  
```{r setup}
library(VennDiagram)

# set output file for figures 
knitr::opts_chunk$set(fig.path = '../figures/05_metaanalyses/')
```


```{r ImportFlattenData}
dissociation_venn123 <- read.table("../results/01_dissociation_venn123.txt")
dissociation_venn4 <- read.table("../results/01_dissociation_venn4.txt")
dissociation_venn1 <- read.table("../results/01_dissociation_venn1.txt")

stress_venn123 <- read.table("../results/02_stress_venn123.txt")
#stress_venn4 <- read.table("../results/02_stress_venn4.txt")
stress_venn1 <- read.table("../results/02_stress_venn1.txt")

cognition_venn123 <- read.table("../results/03_cognition_venn123.txt")
cognition_venn4 <- read.table("../results/03_cognition_venn4.txt")
cognition_venn1 <- read.table("../results/03_cognition_venn1.txt")


cembrowski_venn123 <- read.table("../results/04_cembrowski_venn123.txt")
cembrowski_venn4 <- read.table("../results/04_cembrowski_venn4.txt")
cembrowski_venn1 <- read.table("../results/04_cembrowski_venn1.txt")


#flatten to lists not dfs
dissociation_venn123 <- unlist(apply(dissociation_venn123, 1, list), recursive = FALSE)
stress_venn123 <- unlist(apply(stress_venn123, 1, list), recursive = FALSE)
cognition_venn123 <- unlist(apply(cognition_venn123, 1, list), recursive = FALSE)
cembrowski_venn123 <- unlist(apply(cembrowski_venn123, 1, list), recursive = FALSE)

dissociation_venn4 <- unlist(apply(dissociation_venn4, 1, list), recursive = FALSE)
#stress_venn4 <- unlist(apply(stress_venn4, 1, list), recursive = FALSE)
cognition_venn4 <- unlist(apply(cognition_venn4, 1, list), recursive = FALSE)
cembrowski_venn4 <- unlist(apply(cembrowski_venn4, 1, list), recursive = FALSE)

dissociation_venn1 <- unlist(apply(dissociation_venn1, 1, list), recursive = FALSE)
stress_venn1 <- unlist(apply(stress_venn1, 1, list), recursive = FALSE)
cognition_venn1 <- unlist(apply(cognition_venn1, 1, list), recursive = FALSE)
cembrowski_venn1 <- unlist(apply(cembrowski_venn1, 1, list), recursive = FALSE)

length(dissociation_venn123)
length(stress_venn123)
length(cognition_venn123)  
146/length(cembrowski_venn123)
```


Figure 2A: Interesection of all genes differentially regulated by treatment

```{r VennDiagramTreatement4, echo=FALSE, message=FALSE, results='hide',comment=FALSE, warning=FALSE}
candidates <- list("Dissociation" = dissociation_venn4, "Cognition" = cognition_venn4)

prettyvenn <- venn.diagram(
  scaled=T,
  x = candidates, filename=NULL, 
  fill = c( "white", "white"),
  alpha = 0.5,
  #cex = 1, 
  fontfamily = "sans", #fontface = "bold",
  cat.default.pos = "text",
  #cat.dist = c(0.1, 0.1), cat.pos = 1,
  cat.cex = 1, cat.fontfamily = "sans",
  col = "black"
  )
#dev.off()
grid.draw(prettyvenn)
```

Figure 5A: Interesection of all genes differentially regulated between any of the three brain regions (CA1, CA3, DG)

```{r VennDiagramRegion}
candidates <- list("Dissociation" = dissociation_venn123, "Cembrowski" = cembrowski_venn123, "Stress" = stress_venn123, "Cognition" = cognition_venn123)

prettyvenn <- venn.diagram(
  scaled=T,
  x = candidates, filename=NULL, 
  fill = c( "white", "white", "white", "white"),
  alpha = 0.5,
  #cex = 1, 
  fontfamily = "sans", #fontface = "bold",
  cat.default.pos = "text",
  #cat.dist = c(0.1, 0.1, 0.1), cat.pos = 1,
  cat.cex = 1, cat.fontfamily = "sans",
  col = "black"
  )
#dev.off()
grid.draw(prettyvenn)
```

```{r VennDiagramRegionPercentages}
146/length(dissociation_venn123) #44%
146/length(stress_venn123)       # 9%
146/length(cognition_venn123)    # 4%
146/length(cembrowski_venn123)   # 1%
```

Save files with the gene names found in overlapping circle.  

```{r CreateIntersections, echo=FALSE, message=FALSE, results='hide',comment=FALSE, warning=FALSE}
# extract the intersection all experiments any region
intersection <- Reduce(intersect, list(dissociation_venn123,stress_venn123,cognition_venn123, cembrowski_venn123))
intersection <- as.data.frame(intersection)
intersection <- t(intersection)
rownames(intersection) <- NULL
intersection <- as.data.frame(intersection)
colnames(intersection)[1] <- "gene"
intersection

write.csv(intersection, "./06_GO_MWU/05_metaanalyses_intersection.csv", row.names = F)


# extract the intersection cognition and dissociation
cognitiondissociation <- Reduce(intersect, list(cognition_venn4,dissociation_venn4))
cognitiondissociation <- as.data.frame(cognitiondissociation)
cognitiondissociation <- t(cognitiondissociation)
rownames(cognitiondissociation) <- NULL
cognitiondissociation <- as.data.frame(cognitiondissociation)
colnames(cognitiondissociation)[1] <- "gene"
cognitiondissociation

write.csv(cognitiondissociation, "./06_GO_MWU/05_metaanalyses_cognitiondissociation.csv", row.names = F)
```
